---
title: 数据结构
categories: 
- 学习笔记
- Redis1
---

<img src="https://xiaoflyfish.oss-cn-beijing.aliyuncs.com/image/20210219234042.png" style="zoom:33%;" />

**键和值用什么结构组织**

Redis 使用了一个哈希表来保存所有键值对

一个哈希表，其实就是一个数组，数组的每个元素称为一个哈希桶。所以，我们常说，一个哈希表是由多个哈希桶组成的，每个哈希桶中保存了键值对数据。

哈希桶中的元素保存的并不是值本身，而是指向具体值的指针。

<img src="https://xiaoflyfish.oss-cn-beijing.aliyuncs.com/image/20210219234142.png" style="zoom:33%;" />

**为什么哈希表操作变慢了**

<img src="https://xiaoflyfish.oss-cn-beijing.aliyuncs.com/image/20210219234437.png" style="zoom:33%;" />

Redis 会对哈希表做 rehash 操作, 为了使 rehash 操作更高效，Redis 默认使用了两个全局哈希表

一开始，当你刚插入数据时，默认使用哈希表 1，此时的哈希表 2 并没有被分配空间。随着数据逐步增多，Redis 开始执行 rehash，这个过程分为三步：

1. 给哈希表 2 分配更大的空间，例如是当前哈希表 1 大小的两倍；
2. 把哈希表 1 中的数据重新映射并拷贝到哈希表 2 中；
3. 释放哈希表 1 的空间。

**渐进式 rehash:**

简单来说就是在第二步拷贝数据时，Redis 仍然正常处理客户端请求，每处理一个请求时，从哈希表 1 中的第一个索引位置开始，顺带着将这个索引位置上的所有 entries 拷贝到哈希表 2 中；等处理下一个请求时，再顺带拷贝哈希表 1 中的下一个索引位置的 entries

**有哪些底层数据结构**

集合类型的底层数据结构主要有 5 种：

1. 整数数组
2. 双向链表
3. 哈希表
4. 压缩列表
5. 跳表

# 压缩列表

压缩列表实际上类似于一个数组，数组中的每一个元素都对应保存一个数据。和数组不同的是，压缩列表在表头有三个字段 zlbytes、zltail 和 zllen，分别表示列表长度、列表尾的偏移量和列表中的 entry 个数；压缩列表在表尾还有一个 zlend，表示列表结束。

# 跳表

跳表在链表的基础上，增加了多级索引，通过索引位置的几个跳转，实现数据的快速定位

<img src="https://xiaoflyfish.oss-cn-beijing.aliyuncs.com/image/20210219234947.png" style="zoom:33%;" />