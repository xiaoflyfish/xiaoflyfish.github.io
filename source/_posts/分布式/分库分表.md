---
title: 分库分表
categories: 
- 分布式
---

参考《阿里巴巴 Java 开发手册》中**单表行数超过 500 万行**进行分表的建议，需要考虑进行分库分表

# 分表策略

## Range

首先第一种是按照范围划分，比如我们可以将某张表的创建时间按照日期划分存为月表；也可以将某张表的主键按照范围划分，比如 `1~10000`在一张表，`10001~20000`在一张表，以此类推

这样的分表适合需要对数据做归档处理，比如系统默认只提供近三个月历史数据的查询功能，只需要把三月之前的数据单独移走备份保存即可）

**弊端：**

- 好处是自带水平扩展，不需要过多干预
- 缺点是可能会出现数据不均匀的情况（比如某个月请求暴增）

## Hash

通过哈希取模的方式进行路由，优点是数据拆分比较均匀，但缺点是不利于后面的扩容

## Range+Hash

当然还有一种思路， `Range` 和 `Hash` 可以混用

比如我们一开始采用的是 Hash 分表，但是数据增长巨大，导致每张分表数据很快达到瓶颈，这样就不得不再做扩容，比如由 64 张表扩容到 256 张

但扩容时想要做到不停机迁移数据非常困难

所以我们是否可以在 `Hash` 分表的基础上再分为月表，借助于 `Range` 自身的扩展性就不用考虑后续数据迁移的事情了

