---
title: 守护线程
categories: 
- 并发编程
- 线程
---

Java 提供了两种类型的线程：守护线程 和 用户线程

- 用户线程 是高优先级线程。JVM 会在终止之前等待任何用户线程完成其任务。
- 用户线程 是低优先级线程。其唯一作用是为用户线程提供服务

由于守护线程的作用是为用户线程提供服务，并且仅在用户线程运行时才需要，因此一旦所有用户线程完成执行，JVM 就会终止。也就是说 守护线程不会阻止 JVM 退出

守护线程用于后台支持任务，比如垃圾回收、释放未使用对象的内存、从缓存中删除不需要的条目。

**如何创建守护线程**

要将普通线程设置为守护线程，方法很简单，只需要调用 `Thread.setDaemon()` 方法即可

```java
NewThread daemonThread = new NewThread();
daemonThread.setDaemon(true);
daemonThread.start();
```

在 Java 语言中，线程的状态是自动继承的。任何线程都会继承创建它的线程的守护程序状态

- 如果一个线程是普通线程（ 用户线程） ，那么它创建的子线程默认也是普通线程（ 用户线程 ）。
- 如果一个线程是守护线程，那么它创建的子线程默认也是守护线程。

由于主线程是用户线程，因此在 main() 方法内创建的任何线程默认为用户线程。

需要注意的是调用 `setDaemon() `方法的时机，该方法只能在创建 Thread 对象并且在启动线程前调用。在线程运行时尝试调用` setDaemon()` 将抛出 `IllegalThreadStateException `异常

检查一个线程是否是守护线程，可以简单地调用方法 `isDaemon()`