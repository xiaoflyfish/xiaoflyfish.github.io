---
title: 常用线程池
categories: 
- 并发编程
- 线程池
---

**FixedThreadPool**

创建一个定长线程池，可控制线程最大并发数，超出的线程会在队列中等待

```java
public static ExecutorService newFixedThreadPool(int nThreads) {
    return new ThreadPoolExecutor(nThreads, nThreads,
                                  0L, TimeUnit.MILLISECONDS,
                                  new LinkedBlockingQueue<Runnable>());
}
```

我们可以看到corePoolSize核心线程数量和maximumPoolSize最大线程数量是一致的，并且keepAliveTime为0。

workQueue是LinkedBlockingQueue，这是一个链表阻塞队列。

可以得出结论：该线程池是一个固定数量的线程池，并且有一个无界的等待队列。

适合场景：适合少量的大任务（大任务处理慢，如果线程数量多的话，反而在切换线程上下文时损耗，所以控制线程在一定的数量）

**CachedThreadPool**

newCachedThreadPool创建一个可缓存线程池，如果线程池长度超过处理需要，可灵活回收空闲线程，若无可回收，则新建线程

```java
public static ExecutorService newCachedThreadPool() {
    return new ThreadPoolExecutor(0, Integer.MAX_VALUE,
                                  60L, TimeUnit.SECONDS,
                                  new SynchronousQueue<Runnable>());
}
```

我们可以看到corePoolSize核心线程池为0，代表该线程没有核心线程池，意味着线程都是可被回收销毁的，线程池中有时会是空的。并且maximumPoolSize是int最大值，相当于代表该线程池可以无限创建线程。

keepAliveTime为60，代表空闲60秒回收线程。workQueue是SynchronousQueue，该同步队列是一个没有容量队列，即一个任务到来后，要等待线程来消费，才能再继续添加任务

适合场景：大量的小任务（每个任务处理快，不会频繁出现线程处理一半时，切换其他线程）

**ScheduledThreadPool**

创建一个定长线程池，支持定时及周期性任务执行

```java
public ScheduledThreadPoolExecutor(int corePoolSize) {
    super(corePoolSize, Integer.MAX_VALUE, 0, NANOSECONDS,
          new DelayedWorkQueue());
}
```

我们可以看到该线程池参数最大的区别在于workQueue是DelayedWorkQueue。该队列是一个按延迟时间从小到大排序的堆。并且当队列头节点的延迟时间小于0的时候返回该节点。所以该线程池可以指定一个时间进行定时任务。也可以通过添加任务时递增延迟时间，来进行周期任务

适合场景：定时任务或者周期任务

**SingleThreadExecutor**

创建一个单线程化的线程池，它只会用唯一的工作线程来执行任务，保证所有任务按照指定顺序(FIFO, LIFO, 优先级)执行

```java
public static ExecutorService newSingleThreadExecutor() {
    return new FinalizableDelegatedExecutorService
        (new ThreadPoolExecutor(1, 1,
                                0L, TimeUnit.MILLISECONDS,
                                new LinkedBlockingQueue<Runnable>()));
}
```

我们可以看到该线程池的corePoolSize核心线程数量和maximumPoolSize最大线程数量都是1，代表该线程有且只有一个固定的线程，既然是单线程，所以该线程池实现的是串行操作，没有并发效果。workQueue是LinkedBlockingQueue，这是一个链表阻塞队列。所以该线程池适合执行串行执行队列中的任务

适合场景：按顺序串行处理的任务