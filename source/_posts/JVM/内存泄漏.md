---
title: 内存泄漏
categories: 
- JVM
---

内存泄露的定义：对于应用程序来说，当对象已经不再被使用，但是Java的垃圾回收器不能回收它们的时候，就产生了内存泄露

**造成内存泄露的常见情形**

1.集合类，比如HashMap，ArrayList等，这些对象经常会发生内存泄露。比如当它们被声明为静态对象时，它们的生命周期会跟应用程序的生命周期一样长，很容易造成内存不足。

像HashMap、Vector等的使用最容易出现内存泄露，这些静态变量的生命周期和应用程序一致，他们所引用的所有的对象Object也不能被释放，因为他们也将一直被Vector等引用着。

```java
Static Vector v = new Vector(10);
for (int i = 1; i<100; i++) {
    Object o = new Object();
    v.add(o);
    o = null;
}
```

2.当集合里面的对象属性被修改后，再调用remove()方法时不起作用。

3.监听器

释放对象的时候却没有记住去删除对应的监听器，从而增加了内存泄漏的机会。

4.各种连接

比如数据库连接（`dataSourse.getConnection()`），网络连接(socket)和io连接，除非其显式的调用了其close()方法将其连接关闭，否则是不会自动被GC 回收的。

一般都会在try里面去的连接，在finally里面释放连接。

5.内部类和外部模块的引用

内部类的引用是比较容易遗忘的一种，而且一旦没释放可能导致一系列的后继类对象没有释放。

例如程序员A 负责A模块，调用了B模块的一个方法如： `public void registerMsg(Object b);` 这种调用就要非常小心了，传入了一个对象，很可能模块B就保持了对该对象的引用，这时候就需要注意模块B是否提供相应的操作去除引用。

6.单例模式

不正确使用单例模式是引起内存泄漏的一个常见问题，单例对象在初始化后将在JVM的整个生命周期中存在（以静态变量的方式），如果单例对象持有外部的引用，那么这个对象将不能被JVM正常回收，导致内存泄漏