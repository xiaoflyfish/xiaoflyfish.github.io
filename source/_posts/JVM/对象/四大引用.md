---
title: 四大引用
categories: 
- JVM
- 对象
---

# 强引用

当JVM进行GC时，对于强引用对象，就算出现了OOM也不会对该对象进行回收。强引用是造成Java内存泄露的主要原因之一

只有在和 GC Roots 断绝关系时，才会被消灭掉

# 软引用

对于软引用关联的对象，在系统将要发生内存溢出异常之前，将会把这些对象列进回收范围之内。

如果这次回收后还没有足够的内存，才会抛出异常。即：

- 当系统内存充足时，软引用不会回收；
- 当系统内存不足时，软引用会被回收，回收后内存仍然不足，就抛出异常；

软引用通常用在内存敏感的程序中，例如高速缓存中就用到软引用。

Guava 的 CacheBuilder，就提供了软引用和弱引用的设置方式。在这种场景中，软引用比强引用安全的多。

软引用可以和一个引用队列（ReferenceQueue）联合使用，如果软引用所引用的对象被垃圾回收，Java 虚拟机就会把这个软引用加入到与之关联的引用队列中。

# 弱引用

弱引用通过`java.lang.ref.WeakReference`来完成，当JVM进行GC时，无论内存是否充足，被弱引用关联的对象都会被回收，即弱引用关联的对象活不到下一次GC时刻

# 虚引用

虚引用需要`java.lang.ref.PhantomReference`类来实现，如果一个对象仅持有虚引用，那么它和没有任何引用一样，调用get()方法总返回null，在任何时候都可能被垃圾回收器回收，虚引用必须和引用队列(ReferenceQueue)联合使用：

虚引用的唯一目的就是：当该对象被垃圾收集器回收的时候收到一个系统通知或者后续添加进一步处理，它的作用在于跟踪垃圾回收过程

具体流程：创建引用时候可以指定关联的队列，当GC释放对象的时候会将引用的对象添加到引用队列中，如果程序发现某个虚引用对象已经被加入到引用队列中，那么就可以在引用对象的内存回收之前采取必要的措施，这就相当于一种通知机制