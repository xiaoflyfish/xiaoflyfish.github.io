---
title: 基本结构
categories: 
- JVM
- 对象
---

HotSpot虚拟机中，对象在内存中存储的布局可以分为三块区域：对象头、实例数据和对齐填充

**对象头**

对象头包括两部分信息：运行时数据`Mark Word`和类型指针

如果对象是数组对象，那么对象头占用3个字宽（`Word`）(需要记录数组长度)，如果对象是非数组对象，那么对象头占用2个字宽（`1word = 2Byte = 16bit`）

对象头的类型指针指向该对象的类元数据，虚拟机通过这个指针可以确定该对象是哪个类的实例

**Mark Word**

用于存储对象自身的运行时数据， 如哈希码（`HashCode`）、GC分代年龄、锁状态标志、线程持有的锁、偏向线程ID、偏向时间戳等等，它是实现轻量级锁和偏向锁的关键。

这部分数据的长度在32位和64位的虚拟机（暂不考虑开启压缩指针的场景）中分别为32个和64个Bits。

考虑到虚拟机的空间效率，`Mark Word`被设计成一个非固定的数据结构以便在极小的空间内存储尽量多的信息，它会根据对象的状态复用自己的存储空间。

例如在32位的HotSpot虚拟机 中对象未被锁定的状态下，`Mark Word`的32个Bits空间中的25Bits用于存储对象哈希码（`HashCode`），4Bits用于存储对象分代年龄，2Bits用于存储锁标志位，1Bit固定为0

**实例数据**

实例数据就是在程序代码中所定义的各种类型的字段，包括从父类继承的，这部分的存储顺序会受到虚拟机分配策略和字段在源码中定义顺序的影响

**对齐填充**

由于`HotSpot`的自动内存管理要求对象的起始地址必须是8字节的整数倍，即对象的大小必须是8字节的整数倍，对象头的数据正好是8的整数倍，所以当实例数据不够8字节整数倍时，需要通过对齐填充进行补全

意思是每次分配的内存大小一定是8的倍数，如果对象头+实例数据的值不是8的倍数，那么会重新计算一个较大值，进行分配



