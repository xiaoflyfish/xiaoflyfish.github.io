---
title: Pipeline
categories: 
- Redis
---

**Pipeline交互模型**

客户端首先将执行的命令写入到缓冲区（内存）中，最后再一次性发送 `Redis`。

pipeline通过将一批命令进行打包，然后发送给服务器，服务器执行完按顺序打包返回，这样就减少了频繁交互往返的时间，提升了性能

**基本使用**

```java
Pipeline pipeline =jedis.pipelined();
// 循环添加 1000个元素
for(int i = 0; i < 1000; i++){
    pipeline.rpush("rediskey", i + "");
        }
//执行 
pipeline.sync()
```

# 优缺点

**Pipeline的优点：**

pipeline 通过打包命令，一次性执行，可以节省连接->发送命令->返回结果这个过程所产生的往返时间，减少的I/O的调用（用户态到内核态之间的切换）次数。

**Pipeline的缺点：**

pipeline 每批打包的命令不能过多，因为 pipeline 方式打包命令再发送，那么 `redis` 必须在处理完所有命令前先缓存起所有命令的处理结果。这样就有一个内存的消耗。

pipeline不保证原子性，执行命令过程中，如果一个命令出现异常，也会继续执行其他命令，所以如果要求原子性的，不推荐使用 pipeline

pipeline每次只能作用在一个`Redis`节点上

**适用场景**

比如短信群发这种场景，如果一下群发10000条，按照第一种模式去实现，那这个请求过来，要很久才能给客户端响应，这个延迟就太长了，如果客户端请求设置了超时时间5秒，那肯定就抛出异常了，而且本身群发短信要求实时性也没那么高，这时候用pipeline最好了。